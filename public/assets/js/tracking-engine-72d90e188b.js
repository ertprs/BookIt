class PatientTracking{constructor(t,e,a,s){this.slots=s,console.log(s),this.trackId=$("#"+t),this.userId=e,this.userName=a,this.socket=io.connect("http://localhost:5000"),this.userId&&this.connectionHandler()}connectionHandler(){let self=this;if(this.socket.on("connect",(function(){console.log("Connection established using sockets"),self.socket.emit("join_room",{user_id:self.userId,user_name:self.userName,chatroom:"pts"}),self.socket.on("user_joined",(function(t){console.log(t.user_name+" has joined the patient tracking system.",t)}))})),self.slots>1){var ar=[];for(let i=0;i<self.slots;i++)ar.push(eval('document.querySelectorAll("#updateStatus'+i+'");'));for(let t=0;t<ar.length;t++)for(let e=0;e<ar[t].length;e++)ar[t][e].addEventListener("click",(function(a){if(a.preventDefault(),"waiting"==ar[t][e].getAttribute("data-waiting")){let a=ar[t][e].getAttribute("data-tid"),s=ar[t][e].getAttribute("data-count"),i=ar[t][e].getAttribute("data-name");self.socket.emit("send_slot_status",{seat:s,tid:a,user_id:self.userId,chatroom:"pts",index:e,status:"Waiting",name:i,slot:t})}else{let a=ar[t][e].getAttribute("data-slot"),s=document.querySelectorAll(".upcoming-li"+a)[0].getAttribute("data-index"),i=ar[t][e].getAttribute("data-count");if(console.log(s,i),s==i){let a=ar[t][e].getAttribute("data-tid"),s=ar[t][e].getAttribute("data-name");self.socket.emit("send_slot_status",{seat:i,tid:a,user_id:self.userId,chatroom:"pts",index:e,status:"ongoing",name:s,slot:t})}else{let a=ar[t][e].getAttribute("data-tid"),l=ar[t][e].getAttribute("data-name"),n=ar[t][e].getAttribute("data-mindex");for(let e=s-1;e<i-1;e++)ar[t][e].setAttribute("data-waiting","waiting");self.socket.emit("send_slot_status",{seat:i,tid:a,user_id:self.userId,chatroom:"pts",index:e,start:s,mindex:n,status:"ongoing",name:l,slot:t})}}}))}else{var trackButton=document.querySelectorAll("#updateStatus");for(let t=0;t<trackButton.length;t++)trackButton[t].addEventListener("click",(function(e){if(e.preventDefault(),"waiting"==trackButton[t].getAttribute("data-waiting")){let e=trackButton[t].getAttribute("data-tid"),a=trackButton[t].getAttribute("data-count"),s=trackButton[t].getAttribute("data-name");self.socket.emit("send_status",{seat:a,tid:e,user_id:self.userId,chatroom:"pts",index:t,status:"Waiting",name:s})}else{let e=document.querySelectorAll(".upcoming-li")[0].getAttribute("data-index"),a=trackButton[t].getAttribute("data-count");if(console.log(e,a),e==a){let e=trackButton[t].getAttribute("data-tid"),s=trackButton[t].getAttribute("data-name");self.socket.emit("send_status",{seat:a,tid:e,user_id:self.userId,chatroom:"pts",index:t,status:"ongoing",name:s})}else{let s=trackButton[t].getAttribute("data-tid"),i=trackButton[t].getAttribute("data-name"),l=trackButton[t].getAttribute("data-mindex");for(let t=e-1;t<a-1;t++)trackButton[t].setAttribute("data-waiting","waiting");self.socket.emit("send_status",{seat:a,tid:s,user_id:self.userId,chatroom:"pts",index:t,start:e,mindex:l,status:"ongoing",name:i})}}}))}self.socket.on("receive_status",(function(t){if(console.log("message recieved",t),t.cname){var e=document.querySelectorAll("#updatedStatus1"),a=document.querySelectorAll("#updatedStatus2");t.data.user_id==self.userId&&(e[t.data.index].classList.add("displayNone"),a[t.data.index].classList.remove("displayNone")),$("#patient-ul li a").last().addClass("displayNone"),$("#patient-ul li h3").last().removeClass("displayNone");for(let e=0;e<t.data.seat-t.data.start;e++){var s=parseInt(t.data.start)+e;let a=$('<li class="patient-li">');var i=a.append($("<h4>",{html:'<span><i class="fas fa-user-md"></i></span>Patient No. '+s})).append($("<h5>",{html:t.cname[e]})).append($('<a class="displayNone uongoing">Ongoing</a>')).append($('<h2 class="b_red uwaiting"><span><i class="fas fa-hourglass" aria-hidden="true" style="margin-right: 8px;"></i></span>Waiting</h2>')).append($('<h3 class="displayNone uvisited"><span><i class="fas fa-child" aria-hidden="true" style="margin-right: 8px;"></i></span>Visited</h3>'));$("#patient-ul").append(a)}let d=document.querySelectorAll(".upcoming-li");for(let e=0;e<=t.data.seat-t.data.start;e++)console.log(d[e].getAttribute("data-index")),d[e].remove();let r=$('<li class="patient-li">');i=r.append($("<h4>",{html:'<span><i class="fas fa-user-md"></i></span>Patient No. '+t.data.seat})).append($("<h5>",{html:t.data.name})).append($('<a class = "uongoing" >Ongoing</a>')).append($('<h2 class="b_red uwaiting displayNone"><span><i class="fas fa-hourglass" aria-hidden="true" style="margin-right: 8px;"></i></span>Waiting</h2>')).append($('<h3 class="displayNone uvisited"><span><i class="fas fa-child" aria-hidden="true" style="margin-right: 8px;"></i></span>Visited</h3>'));var l=(o=(new Date).toLocaleTimeString()).slice(0,5),n=o.slice(8,11);i.append($("<p>",{html:"CheckIn Time : "+l+" "+n})),$("#no_patient").last().addClass("displayNone"),$("#patient-ul").append(r)}else if("Waiting"==t.status){e=document.querySelectorAll("#updatedStatus1"),a=document.querySelectorAll("#updatedStatus2");t.user_id==self.userId&&(e[t.index].classList.add("displayNone"),a[t.index].classList.remove("displayNone"));let s=document.querySelectorAll(".activeongoing"),i=document.querySelectorAll(".activevisit"),l=s.length,n=i.length;l>0&&n>0&&(console.log("u are there"),s[l-1].classList.add("displayNone"),i[n-1].classList.remove("displayNone"));let o=document.querySelectorAll(".uwaiting"),r=document.querySelectorAll(".uongoing");var d=document.querySelectorAll(".uvisited");o[t.index].classList.add("displayNone"),r[t.index].classList.add("activeongoing"),d[t.index].classList.add("activevisit"),r[t.index].classList.remove("displayNone"),$("#patient-ul li a").last().addClass("displayNone"),$("#patient-ul li h3").last().removeClass("displayNone")}else{let s=$('<li class="patient-li">');e=document.querySelectorAll("#updatedStatus1"),a=document.querySelectorAll("#updatedStatus2");t.user_id==self.userId&&(e[t.index].classList.add("displayNone"),a[t.index].classList.remove("displayNone"));var o;i=s.append($("<h4>",{html:'<span><i class="fas fa-user-md"></i></span>Patient No. '+t.seat})).append($("<h5>",{html:t.name})).append($('<a class="uongoing">Ongoing</a>')).append($('<h2 class="b_red uwaiting displayNone"><span><i class="fas fa-hourglass" aria-hidden="true" style="margin-right: 8px;"></i></span>Waiting</h2>')).append($('<h3 class="uvisited displayNone"><span><i class="fas fa-child" aria-hidden="true" style="margin-right: 8px;"></i></span>Visited</h3>')),l=(o=(new Date).toLocaleTimeString()).slice(0,5),n=o.slice(8,11);i.append($("<p>",{html:"CheckIn Time : "+l+" "+n}));let d=document.querySelectorAll(".activeongoing"),r=document.querySelectorAll(".activevisit"),u=d.length,c=r.length;u>0&&c>0&&(console.log("u are there"),d[u-1].classList.add("displayNone"),r[c-1].classList.remove("displayNone")),$("#no_patient").last().addClass("displayNone"),$(".upcoming-ul li:first-child").remove(),$("#patient-ul li a").last().addClass("displayNone"),$("#patient-ul li h3").last().removeClass("displayNone"),$("#patient-ul").append(s)}})),self.socket.on("receive_slot_status",(function(t){if(console.log("message recieved",t),t.cname){var e=document.querySelectorAll("#updatedStatus1"+t.data.slot),a=document.querySelectorAll("#updatedStatus2"+t.data.slot);t.data.user_id==self.userId&&(e[t.data.index].classList.add("displayNone"),a[t.data.index].classList.remove("displayNone"));let d=document.querySelectorAll(".upcoming-li"+t.data.slot);$(`#patient-ul${t.data.slot} li a`).last().addClass("displayNone"),$(`#patient-ul${t.data.slot} li h3`).last().removeClass("displayNone");for(let e=0;e<t.data.seat-t.data.start;e++){var s=parseInt(t.data.start)+e;let a=$('<li class="patient-li">');var i=a.append($("<h4>",{html:'<span><i class="fas fa-user-md"></i></span>Patient No. '+s})).append($("<h5>",{html:t.cname[e]})).append($('<a class="displayNone uongoing'+t.data.slot+'">Ongoing</a>')).append($('<h2 class="b_red uwaiting'+t.data.slot+'"><span><i class="fas fa-hourglass" aria-hidden="true" style="margin-right: 8px;"></i></span>Waiting</h2>')).append($('<h3 class="displayNone uvisited'+t.data.slot+'"><span><i class="fas fa-child" aria-hidden="true" style="margin-right: 8px;"></i></span>Visited</h3>'));$("#patient-ul"+t.data.slot).append(a)}for(let e=0;e<=t.data.seat-t.data.start;e++)d[e].remove();let r=$('<li class="patient-li">');i=r.append($("<h4>",{html:'<span><i class="fas fa-user-md"></i></span>Patient No. '+t.data.seat})).append($("<h5>",{html:t.data.name})).append($('<a class = "uongoing'+t.data.slot+'" >Ongoing</a>')).append($('<h2 class="b_red uwaiting'+t.data.slot+' displayNone"><span><i class="fas fa-hourglass" aria-hidden="true" style="margin-right: 8px;"></i></span>Waiting</h2>')).append($('<h3 class="displayNone uvisited'+t.data.slot+'"><span><i class="fas fa-child" aria-hidden="true" style="margin-right: 8px;"></i></span>Visited</h3>'));var l=(o=(new Date).toLocaleTimeString()).slice(0,5),n=o.slice(8,11);i.append($("<p>",{html:"CheckIn Time : "+l+" "+n})),$("#no_patient"+t.data.slot).last().addClass("displayNone"),$("#patient-ul"+t.data.slot).append(r)}else if("Waiting"==t.status){e=document.querySelectorAll("#updatedStatus1"+t.slot),a=document.querySelectorAll("#updatedStatus2"+t.slot);t.user_id==self.userId&&(e[t.index].classList.add("displayNone"),a[t.index].classList.remove("displayNone"));let s=document.querySelectorAll(".activeongoing"+t.slot),i=document.querySelectorAll(".activevisit"+t.slot),l=s.length,n=i.length;l>0&&n>0&&(console.log("u are  now there"),s[0].classList.add("displayNone"),i[0].classList.remove("displayNone"));let o=document.querySelectorAll(".uwaiting"+t.slot),r=document.querySelectorAll(".uongoing"+t.slot);var d=document.querySelectorAll(".uvisited"+t.slot);o[t.index].classList.add("displayNone"),r[t.index].classList.add("activeongoing"+t.slot),d[t.index].classList.add("activevisit"+t.slot),r[t.index].classList.remove("displayNone"),$(`#patient-ul${t.slot} li a`).last().addClass("displayNone"),$(`#patient-ul${t.slot} li h3`).last().removeClass("displayNone")}else{console.log(t);let s=$('<li class="patient-li">');e=document.querySelectorAll("#updatedStatus1"+t.slot),a=document.querySelectorAll("#updatedStatus2"+t.slot);t.user_id==self.userId&&(e[t.index].classList.add("displayNone"),a[t.index].classList.remove("displayNone"));var o;i=s.append($("<h4>",{html:'<span><i class="fas fa-user-md"></i></span>Patient No. '+t.seat})).append($("<h5>",{html:t.name})).append($('<a class="uongoing'+t.slot+'">Ongoing</a>')).append($('<h2 class="b_red uwaiting'+t.slot+' displayNone"><span><i class="fas fa-hourglass" aria-hidden="true" style="margin-right: 8px;"></i></span>Waiting</h2>')).append($('<h3 class="uvisited'+t.slot+' displayNone"><span><i class="fas fa-child" aria-hidden="true" style="margin-right: 8px;"></i></span>Visited</h3>')),l=(o=(new Date).toLocaleTimeString()).slice(0,5),n=o.slice(8,11);i.append($("<p>",{html:"CheckIn Time : "+l+" "+n}));let d=document.querySelectorAll(".activeongoing"+t.slot),r=document.querySelectorAll(".activevisit"+t.slot),u=d.length,c=r.length;u>0&&c>0&&(console.log("u are there"),d[0].classList.add("displayNone"),r[0].classList.remove("displayNone")),$("#no_patient"+t.slot).last().addClass("displayNone"),$(`.upcoming-ul${t.slot} li:first-child`).remove(),$(`#patient-ul${t.slot} li a`).last().addClass("displayNone"),$(`#patient-ul${t.slot} li h3`).last().removeClass("displayNone"),$("#patient-ul"+t.slot).append(s)}}))}}